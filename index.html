<!DOCTYPE html>
<html>
<head>
    <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Admin</title>
    <link type="text/css" href="/bootstrap/css/bootstrap.min.css" rel="stylesheet">
    <link type="text/css" href="/bootstrap/css/bootstrap-responsive.min.css" rel="stylesheet">
    <link type="text/css" href="/css/theme.css" rel="stylesheet">
    <link type="text/css" href="/images/icons/css/font-awesome.css" rel="stylesheet">
    <link type="text/css" href='http://fonts.googleapis.com/css?family=Open+Sans:400italic,600italic,400,600'
          rel='stylesheet'>
    <link type="text/css" href="/bootstrap/css/main.css" rel="stylesheet">

    <!-- Flatpickr CSS -->
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/flatpickr/dist/flatpickr.min.css">
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/flatpickr/dist/plugins/monthSelect/style.css">

    <link rel="stylesheet" href="https://code.jquery.com/ui/1.12.1/themes/base/jquery-ui.css">

    <script src="https://cdn.socket.io/4.5.4/socket.io.min.js"></script>
</head>
<body>

    <div class="wrapper">
        <div class="container">
            <div class="row">
                <div class="span3">
                    <div class="sidebar">
                        <ul class="widget widget-menu unstyled">
                            <li>
                                <a data-toggle="collapse" href="#togglePages">
                                    <i class="menu-icon icon-dashboard"></i>
                                    <i class="icon-chevron-down pull-right"></i>
                                    <i class="icon-chevron-up pull-right"></i>
                                    Dashboard
                                </a>
                                <ul id="togglePages" class="collapse in unstyled" > <!-- thêm `in` ở đây -->
                                    <li>
                                        <a href="index.html">
                                            <i class="icon-money"></i>
                                            Total earnings 
                                        </a>
                                    </li>
                                    <li><a href="vacation-day.html"><i class="icon-inbox"></i>Vacation days </a></li>
                                    <li><a href="benefit.html"><i class="icon-tasks"></i>Average benefit </a></li>
                                </ul>
                            </li>
                            <li><a href="#"><i class="menu-icon icon-signout"></i>Logout </a></li>
                        </ul>
                        
                    </div>
                    <!--/.sidebar-->
                </div>
                <!--/.span3-->
                <div class="span9">
                    <div class="content">
                        <div class="btn-controls">
                            <div class="btn-box-row row-fluid">
                                <a href="#" class="btn-box big span4">
                                    <i class="icon-money"></i>
                                    <div class="total-money">
                                        <b id="number-money">0</b>
                                        <b class="concurrency">USD</b>
                                    </div>
                                    
                                    <p class="text-muted">
                                        Total
                                    </p>
                                </a><a href="#" class="btn-box big span4">
                                    <i class="icon-user"></i>
                                    <b id="number-shareholder">0</b>
                                    <p class="text-muted">
                                        Shareholders
                                    </p>
                                </a><a href="#" class="btn-box big span4">
                                    <i class="icon-home"></i>
                                    <b id="number-department">0</b>
                                    <p class="text-muted">
                                        Department
                                    </p>
                                </a>
                            </div>
                    
                        </div>
                        <div class="calendar">
                            <h4 class="title">
                                Chọn năm
                            </h4>
                            <input type="text" id="yearPicker" placeholder="Chọn năm">
                        </div>
                    
                        <!-- Department Bar Chart -->
                        <div class="module">
                            <div class="module-head" id="chart-title">
                                <h3>
                                    Department
                                </h3>
                                <div class="total">
                                    <div class="number-money" id="total-department">2.400</div>
                                    <div class="concurrency">USD</div>
                                </div>
                            </div>
                            <div class="module-body" style="height:400px;">
                                <div style="position:relative; height:100%; width:100%;">
                                    <canvas id="departmentBarChart"></canvas>
                    
                                </div>
                                
                            </div>
                        </div>
                    
                        <!-- Two Pie Charts -->
                        <div class="container-chart row-fluid">
                            <div class="span12">
                                <div class="span6">
                                    <!-- Gender Pie Chart -->
                                    <div class="module pie-chart" style="flex:1;" id="chart-title">
                                        <div class="module-head" id="chart-title">
                                            <h3>Gender</h3>
                                            <div class="total">
                                                <div class="number-money" id="total-gender">2.400</div>
                                                <div class="concurrency">USD</div>
                                            </div>
                                        </div>
                                        <div class="module-body" style="height:350px;">
                                            <div class="chart-body">
                                                <canvas id="genderPieChart"></canvas>
                                            </div>
                                        </div>
                                    </div>
                                </div>
                                <div class="span6">
                                    <!-- Employee Pie Chart -->
                                    <div class="module pie-chart" style="flex:1;" id="chart-title">
                                        <div class="module-head" id="chart-title">
                                            <h3>Employee</h3>
                                            <div class="total">
                                                <div class="number-money" id="total-employee">2.400</div>
                                                <div class="concurrency">USD</div>
                                            </div>
                                        </div>
                                        <div class="module-body" style="height:350px;">
                                            <div class="chart-body">
                                                <canvas id="employeePieChart"></canvas>
                                            </div>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>

                        <div class="container-chart row-fluid">
                            <div class="span12">
                                <div class="span6">
                                    <!-- Shareholder Bar Chart -->
                                    <div class="module pie-chart" style="flex:1;" id="chart-title">
                                        <div class="module-head" id="chart-title">
                                            <h3>Shareholder</h3>
                                            <div class="total">
                                                <div class="number-money" id="total-shareholder">2.400</div>
                                                <div class="concurrency">USD</div>
                                            </div>
                                        </div>
                                        <div class="module-body" style="height:350px;">
                                            <div class="chart-body">
                                                <canvas id="shareholderPieChart" class=""></canvas>
                                            </div>
                                            
                                        </div>
                                    </div>
                                    
                                </div>
                                <div class="span6">
                                     <!-- Ethnicity Pie Chart -->
                                    <div class="module pie-chart" style="flex:1;" id="chart-title">
                                        <div class="module-head" id="chart-title">
                                            <h3>Ethnicity</h3>
                                            <div class="total">
                                                <div class="number-money" id="total-ethnicity">2.400</div>
                                                <div class="concurrency">USD</div>
                                            </div>
                                        </div>
                                        <div class="module-body" style="height:350px;">
                                            <div style="position:relative; height:100%; width:100%;">
                                                <canvas id="ethnicityBarChart" class=""></canvas>
                                            </div>
                                        </div>
                                    </div>
                                    
                                </div>
                            </div>
                        </div>
                    
                        
                    
                       
                    </div>
                    <!--/.content-->
                </div>
                <!--/.span9-->
            </div>
        </div>
        <!--/.container-->
    </div>

    
    
    
    <script src="/Scripts/jquery-1.9.1.min.js" type="text/javascript"></script>
    <script src="/Scripts/jquery-ui-1.10.1.custom.min.js" type="text/javascript"></script>
    <script src="/bootstrap/js/bootstrap.min.js" type="text/javascript"></script>
    <script src="/Scripts/flot/jquery.flot.js" type="text/javascript"></script>
    <script src="/Scripts/flot/jquery.flot.resize.js" type="text/javascript"></script>
    <script src="/Scripts/datatables/jquery.dataTables.js" type="text/javascript"></script>
    <script src="/Scripts/common.js" type="text/javascript"></script>

    <script src="/Scripts/sidebarToggle.js"></script>
    
    
    <script type="module">
        import { insertNavbar, insertFooter } from '/Scripts/component.js';
        insertNavbar('body', 'afterbegin');
        insertFooter('body', 'beforeend');
    </script>

    <!-- <script src="/Scripts/layout.js" type="text/javascript"></script> -->
     
    <!-- !-- Flatpickr JS -->
    <script src="https://cdn.jsdelivr.net/npm/flatpickr" type="text/javascript"></script>
    <script src="https://cdn.jsdelivr.net/npm/flatpickr/dist/plugins/monthSelect/index.js" type="text/javascript"></script>
    <script>
    flatpickr("#yearPicker", {
          dateFormat: "Y",         // Chỉ hiển thị năm
          defaultDate: new Date(), // Tùy chọn: năm hiện tại
          plugins: [
            new monthSelectPlugin({
              shorthand: true,
              dateFormat: "Y",
              theme: "light"
            })
          ]
        });
    </script>

    
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/chartjs-plugin-datalabels"></script>

    <script type="module" src="/src/public/total-earning.js"></script>

    <script>
        let socket;
        const messageHistoryKey = 'messageHistory'; // Key lưu trữ thông báo trong localStorage

        // Lấy thông báo đã lưu trong localStorage
        let messageHistory = JSON.parse(localStorage.getItem(messageHistoryKey)) || []; 

        // Hàm hiển thị thông báo
        function displayMessages() {
            console.log('Displaying messages:', messageHistory);
            // window.location.reload()
        }

        // Hàm khởi tạo WebSocket và kết nối lại nếu bị mất
        function initSocket() {
            try {
                socket = io('http://localhost:5500'); // Kết nối đến WebSocket server

            socket.on('benefitPlanUpdated', (data) => {
                console.log('Received from WebSocket:', data.message);
                // Lưu thông điệp mới vào history và hiển thị tất cả thông điệp đã nhận
                messageHistory.push('Benefit Plan: ' + data.message);
                localStorage.setItem(messageHistoryKey, JSON.stringify(messageHistory)); // Lưu vào localStorage
                displayMessages();
            });

            socket.on('personalChanged', (data) => {
                console.log('Received from WebSocket:', data.message);
                // Lưu thông điệp mới vào history và hiển thị tất cả thông điệp đã nhận
                messageHistory.push('Personal Data: ' + data.message);
                localStorage.setItem(messageHistoryKey, JSON.stringify(messageHistory)); // Lưu vào localStorage
                displayMessages();
            });

            socket.on('connect', () => {
                console.log('WebSocket connected');
            });

            socket.on('disconnect', () => {
                console.log('WebSocket disconnected. Reconnecting...');
                setTimeout(initSocket, 2000);  // Tái kết nối sau 2 giây nếu mất kết nối
            });
            } catch (error) {
                
            }
        }

        // Khởi động kết nối WebSocket ngay khi trang được tải
        initSocket();

        // Hiển thị thông điệp đã lưu khi tải lại trang
        displayMessages();
    </script>

</body>
</html>